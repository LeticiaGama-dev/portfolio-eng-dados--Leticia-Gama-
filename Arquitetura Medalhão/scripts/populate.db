#populate.db carrega os dados processados para o banco de dados

from db import DB
import pandas as pd
import os

db = DB(host="localhost", port=5444, database="postgres", user="postgres", password="1234")

# Primeiro guardamos a lista de arquivos nesta variável 'files'
files = os.listdir("02-silver-validated")
print(f"Arquivos encontrados na pasta: {files}")

print(f"Eu estou trabalhando nesta pasta: {os.getcwd()}")
print(f"Conteúdo total desta pasta: {os.listdir('.')}")

for file in files:
    print(f"Processando agora o arquivo: {file}")
    df = pd.read_parquet(f"02-silver-validated/{file}")

    db.create_table(
        file.replace(".parquet", ""),
        df.columns.tolist()
    )

    db.insert_data(
        file.replace(".parquet", ""),
        df
    )
